language: ruby
env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.24.1
  global:
  - secure: mqiRMZXV/Q+u19yvKkjFZ9Fi0cR+qYz9r0N4H11LkXzqTmC1i6UTbuk02pJIF8gBdavKgrvRaw6z4UTw0V/3zoTBmeTOzdgeB4t7PNIniG3AHBTUeNTNk2PjuyW9DwTsajVrCOsZzYLc6aIYZra0PtAZUp+NyYaJPhh3RLtoEwoZQ9CH69OMVNMd7ODGV456sLrfmY11bxmymEhhF82O6fz/4hK6HLkMtAfj8l5zp+VL3cQh127TisEpgYLEXfT6i8iC0nYrcry7KzkRUpYk/C4gfoFHyPHIr5fw3Br1FBukkiO0BfGtFTL15XGR7EkEliS3GBfQIVt0GSyp0sCh2CjzTpPnUXVMsQuvV1MHCo43ouWeL4z6OvcAgZdy4y4GIJAq7siTj8LCgC/Up1K82Ey2JIogCAM2C41HYYDTojvRBGje+uKvNiMDwpV+QNzBcpOyIbYjMMnSRzbk9H8zgKyLh8P6/mW3a0EU9dFjvXfYEvZszOfatzh2F3YuBRaffZ4O5VE7p9QSRUNU4WqsGNVlTuWISBPZW8tCaZ3bZzkl7eZWl13Km/sASVpDra1nwjQZ9RESRgaOHe4kC4l036BzsFIjzZa60yE//y+Q0qJEBUFYSsIRgHpasRVxODtpjmxPMjCPa9iPMUdKvutvocv2YImALGtzT7DICbewS8o=
  - secure: Nh4KDevQNvx1qnLv5S43OeQe/RYggk7FJ+iqDLPcgNFfSSzg1fm9WrB57WqgGA4eKexKEW4livpnhiHDCTDof+XdPfyMqoOgN6lKDL2Qdk2KTf16zvJI2ZboEp2pZMqSUQr5ne+tvZ1W6pkcRE4RDMfFknYMqLsASKCmMU0QOyZmqMCxrAHDPEWT0aCu+l3W/NK7uY9lswHGIwxgojyq0RLyXm47WxKkWR1ga3iFItCyYwteCD8HEGkJIDtf1rY6zl4Re9uTDG3JTZGMsvE1JmcV1t71DKmheqKMngYwTcTfMpI/zsreruStwlAT7+1rNxW4Nts1LQ7ViuNRW/MSNQ06XxfpSuNM+QYgNBcisgI29qwzAdTq8S51hO1JFdxdIPczdEnbcVDYiAn2ppOnaeSsg/NK05Eoiq3n7LswY8NxNVkc9NxKvEPW17hdfH0nTIsD6QOJtelatykIVWb+Q2P0iQjTzee/ZgqXY3RISg+fkrnaGv/Dbho12LPMfkWRlpgcmEK+4tB3nB9c2KsQqrD7AFgCWXtb5olSLQifjWp+9OnFcgwXAZnmTYonXNogLm7pdj+pRqGZCvC6JTg9lJNLVVl08ma66AEG3fezQCDdekySfUtHFkChy+0TK46RCA/2A+KTdl0khj0H94+BsacMADw/TMfVLgzVGXwbqYI=
  - secure: 1zfHWD/jP3Ike8A1zCvhe4ZRzX96HtUv3YM4gyrlyfrrNi3DzoPQbS00xyE245lwYhwt6ugoUgEEJEqdE9BiX1UFw2cL+7KEjV+h2oC6jhbp9kpEHCRctrJjRdJ9RAdkH976A+BDHgcv2rHnhas6D/a6/SYxapm2QrM0Ou3kOAWfYRy4hfTWO9UtuHpv51Er4IrD3T/gv3FFhOfZHmwlJRaguE1+5J4qTT8qWRWEWusK+miTK8FDB6mgwsop28/f1CdmnKtPQZ1/cCyatmbjwLs5JlyLdYI+1m9fJY2205QSJW3JZGWJP5733I3OIM6+ElPJ0+xw/qsHP44DSMordq+9fSMLopQVZQ3vLfalprm0w3CqMH7wYsBC6xje4rDtq1iNk2EE/NwbpBf73IphAdioQZLedVEVCKC7ZKtpoyzbwnnjfT/aMkO/kSUmamZUvjHMpcQ4H2a6Tw3w7j3AgHU7pgyVAYo+lL/edCvVhaEdqQYqIXpSeIfeILVEvtIq71LBOkRkd8BacKt32AKGXIopuaZBV4d81NlJoeKzYGpa1iCsMw4bF8q3kNqIUefKTS9ORnY0AEE686PEqQ+zHVuIr9YP+BPrHtdRRq8jONSsiLaZiFuYDnVRil7xUHXDUqSItjclMIjlO/SxRJ5P1TRQUKUl1AqjSnfdmnCdXqU=
before_install:
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
install:
- docker-compose build
before_script:
- docker-compose up -d
- sleep 10
- docker ps -a
cache:
  directories:
  - node_modules
script:
- curl localhost
- curl localhost/api/v1
after_script:
- docker-compose down
deploy:
  provider: elasticbeanstalk
  access_key_id:
    secure: $AWS_ACCESS_KEY_ID
  secret_access_key:
    secure: $AWS_ACCESS_KEY_SECRET
  region: $AWS_REGION
  app: $AWS_EB_APPLICATION
  env: $AWS_EB_ENVIRONMENT
  bucket_name: $AWS_EB_S3_BUCKET
